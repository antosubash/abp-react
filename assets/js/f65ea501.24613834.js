"use strict";(self.webpackChunkabp_react=self.webpackChunkabp_react||[]).push([[1534],{363:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>l,contentTitle:()=>a,default:()=>h,frontMatter:()=>o,metadata:()=>i,toc:()=>d});const i=JSON.parse('{"id":"fundamentals/session-management","title":"Session Management","description":"Overview","source":"@site/docs/fundamentals/session-management.md","sourceDirName":"fundamentals","slug":"/fundamentals/session-management","permalink":"/abp-react/docs/fundamentals/session-management","draft":false,"unlisted":false,"editUrl":"https://github.com/antosubash/abp-react/tree/main/docs/docs/fundamentals/session-management.md","tags":[],"version":"current","sidebarPosition":3,"frontMatter":{"sidebar_position":3},"sidebar":"tutorialSidebar","previous":{"title":"Middleware","permalink":"/abp-react/docs/fundamentals/middleware"},"next":{"title":"API Integration","permalink":"/abp-react/docs/fundamentals/api-integration"}}');var r=s(4848),t=s(8453);const o={sidebar_position:3},a="Session Management",l={},d=[{value:"Overview",id:"overview",level:2},{value:"Session Configuration",id:"session-configuration",level:2},{value:"Session Data Structure",id:"session-data-structure",level:2},{value:"Session Operations",id:"session-operations",level:2},{value:"Getting Session Data",id:"getting-session-data",level:3},{value:"Token Refresh",id:"token-refresh",level:3},{value:"Redis Integration",id:"redis-integration",level:2},{value:"Security Features",id:"security-features",level:2},{value:"Best Practices",id:"best-practices",level:2},{value:"Environment Variables",id:"environment-variables",level:2},{value:"Related Components",id:"related-components",level:2}];function c(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,t.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.header,{children:(0,r.jsx)(n.h1,{id:"session-management",children:"Session Management"})}),"\n",(0,r.jsx)(n.h2,{id:"overview",children:"Overview"}),"\n",(0,r.jsx)(n.p,{children:"ABP React implements a robust session management system using iron-session for secure client-side session storage and Redis for server-side token management. This guide explains how sessions are handled in the application."}),"\n",(0,r.jsx)(n.h2,{id:"session-configuration",children:"Session Configuration"}),"\n",(0,r.jsxs)(n.p,{children:["The session configuration is defined in ",(0,r.jsx)(n.code,{children:"sessionOptions.ts"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-typescript",children:"export const sessionOptions: SessionOptions = {\n  password: process.env.SESSION_PASSWORD || 'complex_password_at_least_32_characters_long',\n  cookieName: 'abp-react-session-id',\n  cookieOptions: {\n    secure: process.env.NODE_ENV === 'production',\n  },\n  ttl: 60 * 60 * 24 * 7, // 1 week\n}\n"})}),"\n",(0,r.jsx)(n.h2,{id:"session-data-structure",children:"Session Data Structure"}),"\n",(0,r.jsx)(n.p,{children:"The session data includes authentication and tenant information:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-typescript",children:"interface SessionData {\n  isLoggedIn: boolean\n  access_token?: string\n  code_verifier?: string\n  state?: string\n  userInfo?: {\n    sub: string\n    name: string\n    email: string\n    email_verified: boolean\n  }\n  tenantId?: string\n}\n"})}),"\n",(0,r.jsx)(n.h2,{id:"session-operations",children:"Session Operations"}),"\n",(0,r.jsx)(n.h3,{id:"getting-session-data",children:"Getting Session Data"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-typescript",children:"export async function getSession(): Promise<IronSession<SessionData>> {\n  const session = await getIronSession<SessionData>(await cookies(), sessionOptions)\n  // ... session validation and refresh logic\n  return session\n}\n"})}),"\n",(0,r.jsx)(n.h3,{id:"token-refresh",children:"Token Refresh"}),"\n",(0,r.jsx)(n.p,{children:"The application automatically handles token refresh:"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsx)(n.li,{children:"Checks token expiration"}),"\n",(0,r.jsx)(n.li,{children:"Uses refresh token to obtain new access token"}),"\n",(0,r.jsx)(n.li,{children:"Updates both Redis and session storage"}),"\n",(0,r.jsx)(n.li,{children:"Maintains user session"}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"redis-integration",children:"Redis Integration"}),"\n",(0,r.jsx)(n.p,{children:"Redis is used for server-side token storage:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-typescript",children:"const redisSessionData = {\n  access_token: access_token,\n  refresh_token: refresh_token,\n} as RedisSession\n\nconst redis = createRedisInstance()\nconst redisKey = `session:${session.userInfo.sub}`\nawait redis.set(redisKey, JSON.stringify(redisSessionData))\n"})}),"\n",(0,r.jsx)(n.h2,{id:"security-features",children:"Security Features"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Secure Cookie Storage"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Encrypted session data"}),"\n",(0,r.jsx)(n.li,{children:"HTTPS-only in production"}),"\n",(0,r.jsx)(n.li,{children:"Configurable session duration"}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Token Management"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Secure token storage"}),"\n",(0,r.jsx)(n.li,{children:"Automatic token refresh"}),"\n",(0,r.jsx)(n.li,{children:"Token expiration handling"}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Session Validation"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Regular session checks"}),"\n",(0,r.jsx)(n.li,{children:"Invalid session cleanup"}),"\n",(0,r.jsx)(n.li,{children:"Security header validation"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"best-practices",children:"Best Practices"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Configuration"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Use strong session passwords"}),"\n",(0,r.jsx)(n.li,{children:"Configure appropriate TTL"}),"\n",(0,r.jsx)(n.li,{children:"Enable secure cookies in production"}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Error Handling"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Handle session corruption"}),"\n",(0,r.jsx)(n.li,{children:"Implement graceful degradation"}),"\n",(0,r.jsx)(n.li,{children:"Log session errors"}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Performance"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Minimize session operations"}),"\n",(0,r.jsx)(n.li,{children:"Cache session data when possible"}),"\n",(0,r.jsx)(n.li,{children:"Optimize Redis operations"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"environment-variables",children:"Environment Variables"}),"\n",(0,r.jsx)(n.p,{children:"Required environment variables for session management:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"SESSION_PASSWORD"}),": Secret key for session encryption"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"NEXT_PUBLIC_API_URL"}),": API endpoint for token operations"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"NEXT_PUBLIC_APP_URL"}),": Application base URL"]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"related-components",children:"Related Components"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"/docs/fundamentals/authentication",children:"Authentication"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"/docs/fundamentals/middleware",children:"Middleware"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"/docs/fundamentals/multi-tenancy",children:"Multi-tenancy"})}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(c,{...e})}):c(e)}},8453:(e,n,s)=>{s.d(n,{R:()=>o,x:()=>a});var i=s(6540);const r={},t=i.createContext(r);function o(e){const n=i.useContext(t);return i.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:o(e.components),i.createElement(t.Provider,{value:n},e.children)}}}]);